<!--
 * @Author: chend25 chendd25@163.com
 * @Date: 2022-07-08 22:00:46
 * @LastEditors: chend25 chendd25@163.com
 * @LastEditTime: 2022-08-06 20:46:57
 * @FilePath: \undefinedd:\cdData\notes\工作经历.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
### 字符串解析成算术表达式ast
使用codemirror支持用户输入字符串、数字、变量、预置函数以及系统字段，解析并校验用户输入，输出成ast。  
1. 使用 codemirror 的 token 方法标识用户输入的不同内容，就是给字符串、数字等不同的样式
2. 解析用户输入，转换成数组，内容包括：左右括号、数字、运算符号、字符串、函数名等，使用正则匹配上述内容。
   1. 解析过程中，给运算符号元素一个数字标识符，如果是函数，给函数的左右括号标识。数字越大，在处理成ast过程中应该优先被处理，如括号内内容、乘除法等
   2. 为了解析出负数，要先匹配数字，然后匹配运算符号。同时为了处理负数，在负数元素的前面增加一个 + 元素
3. 将内容数组转换为ast，找到最大标识符，如果是函数，将函数名及函数内的参数处理为一个节点；如果不是函数，那么一定是计算式，将操作运算符及左右两个元素处理为一个节点。每个节点的内容
   1. 函数：函数名、参数
   2. 算术表达式：运算符号，左子节点，右子节点
4. 最后输出成一个节点，就是所需要的ast
5. 递归计算ast每个节点中左子节点和右子节点的值即可

### 解决过什么问题
1. 支持大数据的表格用的是github上的开源项目叫做vue-bigdata-table，我们拷贝到本地将包发到公司的私服上。测试提了一个问题说员工信息表格在某些时候滑不下去。然后我就去看这个bigdata-table的源码，发现他的支持大数据展示的主要思路就是，用3个table，每个table只展示比如30条数据，用户滑动的时候就是这3个table在进行轮换，他会计算每个table的高度，在滚动条滑动的时候，根据高度来判断该展示第n个table的数据了。出现问题的原因就是，我们实际每个表格行的高度为36，但是插件中默认的表格行高度为32，导致在滑动的时候，我实际还在展示第4个table页的数据，但是因为计算高度用的是32，导致计算出来的结果是现在应该展示第5个table页的高度。页面上实际上应该还是展示index为4，5，6的表格，计算后变成展示idnex为5，6，4的表格。整个表格的高度是由顶部一段空白+3个表格的高度+底部一段空白来决定，这个用来控制滚动条在正确的显示位置。因为计算出来的index为1，2，3的表格高度比实际滑动的高度要小，所以顶部空白高度变小，导致整个表格上移了一下，就出现了这个表格在某些时候滑不下去的问题。
2. 我开发的时候发现，有个项目A在ie环境上打不开了，我就去看是什么问题。在ie上debug的时候，发现一个报错提示是一段正则表达式无法识别，但是奇怪的地方是，这个正则表达式是用在一个公共组件里面的，另一个项目B使用了这个组件，可以正常在ie上打开，只有这个项目不行。然后我比较了一下两个项目的区别，想会不会是因为这个正则表达式不是定义在函数里面的，而是在一个js文件中定义的一个常量，在项目A中一打开主页面就是用到了报错正则表达式的组件，可能由于ie本身的某种机制，导致一开始的时候会无法识别正则表达式。我后来把那个正则表达式放到函数里面去了，在使用函数的时候，才会去解析正则表达式。发现可以在ie上正常打开了。

### 挑战最大的项目
1. 核心的费用报销项目，结构复杂，上手难度较大
2. 90%的页面内容支持自定义配置，如自定义配置表单及各种计算和校验规则等，包含配置器的内容，要求代码多场景适配
3. 表单页面嵌套了4层的子组件，且这四层子组件复用场景达到90%以上，要求子组件的功能非常齐全且功能通用，比如最底层的组件是一个input输入框，需要封装包括文本、下拉、数字、金额、远程搜索数据、树、城市等各种类型的输入框，向父组件抛出各种类型的事件，同时保持数据的一致性，以便父组件能够方便处理事件和数据。
4. 非常多的混入，初始化逻辑和数据变化逻辑较为复杂，代码阅读较为困难
5. 页面含有多个表单，涉及跨表单的字段计算，使用跨表单字段作为请求数据的参数，以及跨表单对字段内容合规性的校验
6. 层级结构复杂和数据变化复杂，同时要求组件复用性和可拓展性高，导致项目难度较大

### 页面性能优化
1. 基于elementui简单封装了一个基础树
2. 基于基础树封装了一个符合业务需求的部门树
3. 部门树支持多选。基础树每次选中一个节点时，会向部门树抛出事件，部门树接受事件记录选中节点数量，根据选中节点在右侧渲染选中的数量和选中节点名称
4. 当部门树点击全选按钮时，如果该节点下有1k个子节点，基础树会向父节点emit 1k次节点选中数据，会导致右侧渲染的选中节点数量从0依次渲染到1k，节点名称也会依次渲染
5. 我做的优化就是利用了防抖的思路，设置一个展示选中节点数量和名称的变量为false,当子组件向父组件emit 1k次事件时，在300ms内父组件没有重复响应事件，则该变量才会变为true，右侧选中节点数量才会开始渲染，就会使得渲染从0直接变成1k，而不是从0按顺序渲染到1k